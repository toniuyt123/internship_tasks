{% extends 'base.html' %}

{% block styles %}
{{super()}}
<script type="text/javascript" src="{{ url_for('static', filename='js/deleteitem.js') }}"></script>
{% endblock %}


{% block content %}

<h1>Your cart</h1>
{% if empty %}
<h2> Your cart is empty.</h2>
{% else %}
<table class='table table-striped table-bordered'>
    <thead>
        <tr>
            <th width="2%"></th>
            <th width="10%">Product</th>
            <th>Description</th>
            <th>In stock</th>
            <th>Price</th>
            <th>Quantity</th>
            <th>Total</th>
        </tr>
    </thead>
    <tbody>
        {% set total_price = [0] %}
        {% for item in cartitems %}
        <tr id="item-{{item[1].id}}">
            <td class="delete-item">
                <form action="/cart/remove" method='POST'>
                    <input type="hidden" name="product" value="{{item[1].id}}">
                    <input type="hidden" name="quantity" value="{{ item[0].quantity }}">
                    <button class="delete-btn" type="submit">&#128465;</a>
                </form>
            </td>
            <td><img src="{{ url_for('static', filename='img/' + item[1].imagepath) }}"
                    class="img-thumbnail rounded product-image" id="cartimg" /> </td>
            <td> {{ item[1].name }} </td>
            <td>{% if item[1].quantity > 0 %}
                <span id='in-stock'>In stock</sp+an>
                    {% else %}
                    <span id='out-of-stock'>Out of stock</span>
                    {% endif %}
            </td>
            <td> {{ item[1].price }}$</td>
            <td>
                {{ item[0].quantity }}
                <div>
                    <form action="cart/remove" method="POST" class="float-left">
                        <button class="btn btn-info" name='product' value="{{item[1].id}}" type="submit">-</button>
                    </form>
                    <form action="cart/add" method="POST">
                        <button class="btn btn-info" name='product' value="{{item[1].id}}" type="submit">+</button>
                    </form>
                </div>
            </td>
            <td>
                {% set products_price = item[1].price * item[0].quantity %}
                {{ products_price }}$
                {% if total_price.append(total_price.pop() + products_price) -%}{% endif %}
            </td>
        </tr>
        {% endfor %}
        <tr>
            <td colspan="6"></td>
            <td>{{ total_price[0] }}$</td>
        </tr>
    </tbody>
</table>
<form action="/charge" method="post">
    <input type="hidden" name="cart" value="{{ cartitems[0][0].cartid }}">
    <input type="hidden" name="amount" value="{{ total_price[0] }}">
    <script src="https://checkout.stripe.com/checkout.js" class="stripe-button" data-key="{{ key }}"
        data-description="A Flask Charge" data-amount="{{ total_amount }}" data-locale="auto"></script>
</form>
{% endif %}
{% endblock %}